local assert = require('luassert')
local stub = require('luassert.stub')
local bdd = require('Test.bdd')
local describe = require('Test.bdd.describe')
local snapshot = nil
print("v2")
describe('stubbing userdata'):beforeEach(function()
  snapshot = assert:snapshot()
end):afterEach(function()
  return snapshot:revert()
end):it('successfully stubs userdata', function()
  local s = stub(getmetatable(input), "SetMouseVisible")
  input:SetMouseVisible(true)
  assert.is_not_nil(getmetatable(input.SetMouseVisible))
  return assert.stub(s).was.called_with(input, true)
end):it('removes the stub when done', function()
  return assert.is_nil(getmetatable(input.SetMouseVisible))
end)
local success = bdd.runTests()
return os.exit(success and 0 or 1)
